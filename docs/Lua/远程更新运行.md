# è¿œç¨‹æ›´æ–°è¿è¡Œ

## ä»€ä¹ˆæ˜¯FusionApp
æŽ¥è§¦åˆ°FusionApp

> ä¸€æ¬¾å¯ä»¥å°†ç½‘é¡µæ‰“åŒ…ä¸ºå®‰å“åº”ç”¨çš„AppåŒæ—¶æ”¯æŒLua,Js

ä¹‹å‰ä¸€ç›´è¢«æˆ‘è’åºŸçš„Luaåˆå¯ä»¥ç„•å‘ç¬¬äºŒæ˜¥äº†

-- ç”¨äºŽåˆ¶ä½œå®‰å“å®¢æˆ·ç«¯
## åœ¨è¿™ä¹‹å‰æˆ‘å…ˆé¢„çƒ­ä¸€ä¸‹å¿…è¦çš„LuaçŸ¥è¯†
### ä»€ä¹ˆæ—¶å€™ifè®¤å®šä¸ºå‡
å’Œå…¶ä»–çš„è¯­è¨€ä¸ä¸€æ ·ï¼Œæ‰€æœ‰ç±»åž‹éƒ½èƒ½ä½œä¸ºbool,åŒæ—¶Luaè®¤ä¸ºåªæœ‰nilå’Œfalseä¸ºå‡ï¼Œå…¶ä½™çš„å€¼éƒ½ä¸ºçœŸ
### å¦‚ä½•æŠ›å‡ºä¸€ä¸ªé”™è¯¯
æ‰§è¡Œ`
error("æˆ‘æ˜¯Luaçš„é”™è¯¯ä¿¡æ¯")
`åŽç¨‹åºå°±å°†æ‰“å°é”™è¯¯ç„¶åŽç»“æŸè¿è¡Œ
### ç”¨äºŽdebugçš„æ–­è¨€
```lua
local var = assert(xxx,"å¦‚æžœxxxä¸ºå‡æˆ‘å°†ä½œä¸ºé”™è¯¯ä¿¡æ¯è¢«æ‰“å°å‡ºæ¥")

-- assertå’Œè¿™ä¸ªå‡½æ•°åŸºæœ¬ä¸€è‡´

function MyAssert(xxx,msg)
    if xxx then
        return xxx
    end
    error(msg)
end
```
### Luaçš„åå°„
#### é¦–å…ˆä»‹ç»æœ€åº•å±‚çš„Loadå‡½æ•°
```lua
-- å°†æºä»£ç åŠ è½½è¿›å…¥å½“å‰è¿è¡ŒçŽ¯å¢ƒ
-- å¼•å…¥çš„æºä»£ç å¯ä»¥ä¿®æ”¹è¿è¡ŒçŽ¯å¢ƒä¸­çš„å˜é‡
-- ä½¿ç”¨loadå¿…é¡»åŒ…å« returnè¯­å¥
-- æˆ–è€…æºç æ˜¯å‡½æ•°çš„å½¢å¼
fn = load("å­—ç¬¦ä¸²æºä»£ç ")
-- fnæ˜¯åŠ è½½è¿›æ¥çš„æºç è¢«åŒ…è£…ä¸ºå½“ç„¶çŽ¯å¢ƒçš„ä¸€ä¸ªå‡½æ•°
-- è¿è¡Œå­—ç¬¦ä¸²æºä»£ç 
fn()

```
#### æŽ¥ä¸‹æ¥ä»‹ç»loadstring

loadstring("æºç ")å¯ä»¥åƒload("æºç ")ä¸€æ ·ä½¿ç”¨ï¼Œä½†æ˜¯å¯ä»¥ä¸éœ€è¦returnè¯­å¥

#### loadfile
loadfileå’Œloadstringå‡ ä¹Žä¸€æ ·ï¼Œåªæ˜¯å‚æ•°æ˜¯åŠ è½½æ–‡ä»¶çš„åå­—
æ¯”å¦‚`loadfile("./hi.lua")`

loadstringå’ŒloadfileåŒæ ·æ˜¯åŸºäºŽload

#### é‚£ä¹ˆdofile

```lua
-- åŠ è½½æ–‡ä»¶hi.lua åŒæ—¶è¿è¡Œé‡Œé¢çš„ä»£ç 
doflie("./hi.lua")

-- dofileç­‰åŒè¿™ä¸ªå‡½æ•°

function MyDoFile(path)
    fn = assert(loadfile(path))
    return  fn()
end

-- æ‰€ä»¥æ¯æ¬¡è°ƒç”¨éƒ½ä¼šloadfileä¸€æ¬¡æ€§èƒ½è¾ƒå·®
```

### è¿œç¨‹æ›´æ–°æºç è¿è¡Œ
æ ¹æ®å‰é¢çš„åå°„çŸ¥è¯†æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆè®¾è®¡
```
æ£€æŸ¥è¿œç¨‹æœåŠ¡å™¨çš„æºç ç‰ˆæœ¬ï¼Œå¦‚æžœæ¯”æœ¬åœ°é«˜å°±å·å·ä¸‹è½½ä¸‹æ¥

ç„¶åŽå†æ‰§è¡Œç±»ä¼¼äºŽè¿™ç§ä»£ç 
fn = loadstring(è¿œç¨‹ä¸‹è½½çš„æºç )
-- å¦‚æžœæºç ç¼–è¯‘å¤±è´¥fnå°±ä¸ºnilä¸å†è¿è¡Œ
-- ä½†æ˜¯ä»ç„¶æœ‰è¿è¡Œæ—¶å‡ºé”™åœæŽ‰æ•´ä¸ªç¨‹åºçš„å¯èƒ½
if fn then
    fn()
end

è‡³äºŽæºç é‡Œé¢å¯ä»¥å†™ä»€ä¹ˆä½ æ‡‚çš„:>
```
### é”™è¯¯å¤„ç†
åœ¨è¿™é‡Œè¿è¡Œçš„ä»£ç ç›¸å½“äºŽåœ¨æ²™ç›’è¿è¡Œ
#### pcall
```lua
isOk , unpack(result) = pcall(fn, ... )
-- ... æ˜¯fnçš„å‚æ•°
```
#### å¸¦å¤„ç†é”™è¯¯å‡½æ•°çš„xpcall
```
isOk , unpack(result) = xpcall(fn, errHandle, ... )
-- errHandle(errInfo)
```
åŒæ ·fnå¯ä»¥æ˜¯å‰é¢loadå‡ºæ¥çš„å‡½æ•°

ðŸ˜¼é‚£ä¹ˆå¯ä»¥å·å·è¿è¡Œè¿œç¨‹æºç äº†ï¼ŒåŒæ—¶é˜²æ­¢è¿è¡Œæ—¶å‡ºé”™è€ŒåœæŽ‰æ•´ä¸ªç¨‹åº

> Luaçš„å†…ç½®å‡½æ•°æ–‡æ¡£
https://www.gammon.com.au/scripts/doc.php?lua=pcall
